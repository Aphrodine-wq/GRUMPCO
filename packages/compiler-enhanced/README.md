# @grump/compiler-enhanced

> **Version 2.1.0** | Updated January 31, 2026

Enhanced compiler system for G-Rump with MASSIVE features including incremental compilation, watch mode, bundle analysis, and more.

## Features

### 1. Incremental Compilation
Track file hashes and only recompile changed intents. Maintains a dependency graph for intelligent recompilation.

```typescript
import { createIncrementalCompiler } from '@grump/compiler-enhanced';

const compiler = createIncrementalCompiler({
  incremental: true,
  cacheDir: './.grump/cache'
});

// Check if file needs recompilation
if (compiler.needsRecompilation('./intents/login.intent')) {
  // Compile and cache
  compiler.storeCache(filePath, output, dependencies);
}
```

### 2. Watch Mode
Monitor file system changes with chokidar and auto-recompile with debouncing (300ms).

```typescript
import { createWatchCompiler } from '@grump/compiler-enhanced';

const watcher = createWatchCompiler(config);

watcher.on('change', (event) => {
  console.log(`File ${event.path} ${event.type}`);
});

watcher.on('compiled', (result) => {
  console.log(`Compiled ${result.compiledFiles.length} files`);
});

await watcher.start(['**/*.intent']);
```

### 3. Bundle Analyzer
Visual breakdown of compiled output size with treemap visualization.

```typescript
import { createBundleAnalyzer } from '@grump/compiler-enhanced';

const analyzer = createBundleAnalyzer(config);
const analysis = analyzer.analyze(outputs, intents);

// Generate ASCII report
console.log(analyzer.generateASCII(analysis));

// Generate HTML report
const html = analyzer.generateHTML(analysis);
```

### 4. Dead Code Elimination
Tree shake unused features from intents using mark and sweep algorithm.

```typescript
import { createDeadCodeEliminator } from '@grump/compiler-enhanced';

const dce = createDeadCodeEliminator(config);

// Register intents and dependencies
dce.registerIntent('auth', authIntent, true); // entry point
dce.registerIntent('utils', utilsIntent, false);
dce.registerImport('auth', 'utils', ['hashPassword']);

// Eliminate dead code
const result = dce.eliminate();
console.log(`Removed ${result.bytesRemoved} bytes of dead code`);
```

### 5. Parallel Processing
Worker threads for multi-file compilation utilizing all CPU cores.

```typescript
import { createWorkerPool } from '@grump/compiler-enhanced';

const pool = createWorkerPool({
  parallel: true,
  workers: 4 // defaults to CPU count - 1
});

const results = await pool.executeBatch(tasks);
```

### 6. Custom Transform Pipeline
Plugin system with transform hooks: preParse, postParse, preCompile, postCompile.

```typescript
import { createTransformPipeline, builtinPlugins } from '@grump/compiler-enhanced';

const pipeline = createTransformPipeline({
  plugins: [
    builtinPlugins.minify(),
    builtinPlugins.banner('Generated by G-Rump'),
    {
      name: 'customTransform',
      preCompile: async (context) => {
        // Custom transformation logic
        return { content: transformed, changed: true };
      }
    }
  ]
});
```

### 7. Source Maps
Generate accurate source maps for debugging compiled output.

```typescript
import { createSourceMapGenerator } from '@grump/compiler-enhanced';

const generator = createSourceMapGenerator(config);
generator.addSource('./src/input.intent', content);
generator.addMapping(1, 0, 1, 0, './src/input.intent');

const sourceMap = generator.generate();
```

### 8. Hot Reload System
WebSocket server for live reload with browser extension support.

```typescript
import { createHotReloadServer } from '@grump/compiler-enhanced';

const hotReload = createHotReloadServer({
  hotReload: true,
  hotReloadPort: 3456
});

await hotReload.start();

// Notify clients of changes
hotReload.update(['./dist/output.js']);
```

## CLI Integration

### grump compile

```bash
# Basic compilation
grump compile ./intents

# With all features enabled
grump compile ./intents \
  --watch \
  --analyze \
  --parallel \
  --incremental \
  --dce \
  --source-maps \
  --hot-reload \
  --verbose

# Shorthand
grump compile ./intents -w -a -p -i -s -m
```

### CLI Options

| Flag | Description |
|------|-------------|
| `-w, --watch` | Enable watch mode |
| `-a, --analyze` | Enable bundle analysis |
| `-p, --parallel` | Enable parallel compilation |
| `-i, --incremental` | Enable incremental compilation |
| `--dce` | Enable dead code elimination |
| `-s, --source-maps` | Generate source maps |
| `--hot-reload` | Enable hot reload server |
| `--workers <n>` | Number of worker threads |
| `-o, --out-dir <path>` | Output directory |
| `-c, --config <path>` | Configuration file path |
| `-t, --target <target>` | Target environment |
| `-m, --minify` | Minify output |
| `--verbose` | Verbose output |

## Configuration

Create a `grump.compiler.config.js` file:

```javascript
/** @type {import('@grump/compiler-enhanced').CompilerConfig} */
module.exports = {
  // Core features
  incremental: true,
  watch: false,
  parallel: true,
  workers: 4,
  
  // Optimization features
  dce: true,
  minify: true,
  treeShake: true,
  
  // Output features
  sourceMaps: true,
  hotReload: true,
  hotReloadPort: 3456,
  
  // Paths
  outDir: './dist',
  cacheDir: './.grump/cache',
  
  // Target
  target: 'es2022',
  
  // Transform plugins
  plugins: [
    // Add custom plugins
  ],
  
  // External dependencies
  external: ['react', 'react-dom']
};
```

## API

### EnhancedCompiler

Main compiler class that orchestrates all features:

```typescript
import { createCompiler } from '@grump/compiler-enhanced';

const compiler = createCompiler({
  incremental: true,
  parallel: true,
  analyze: true,
  dce: true,
  sourceMaps: true
});

// Compile
const result = await compiler.compile(['./intents']);

// Watch mode
await compiler.watch(['**/*.intent'], (files) => {
  console.log('Changed:', files);
});

// Cleanup
await compiler.dispose();
```

## Installation

```bash
npm install @grump/compiler-enhanced
```

## Requirements

- Node.js >= 20
- TypeScript >= 5.0

## License

MIT
