# Lighthouse CI Configuration
# Runs automated performance audits on every build

ci:
  collect:
    url:
      - http://localhost:5173
      - http://localhost:5173/chat
      - http://localhost:5173/ship
      - http://localhost:5173/settings
    numberOfRuns: 3
    startServerCommand: 'npm run preview'
    startServerReadyPattern: 'Local:.*:5173'
    startServerReadyTimeout: 30000
    settings:
      preset: 'desktop'
      throttling:
        rttMs: 40
        throughputKbps: 10240
        cpuSlowdownMultiplier: 1
      formFactor: 'desktop'
      screenEmulation:
        width: 1920
        height: 1080
        deviceScaleFactor: 1
        mobile: false

  assert:
    assertions:
      # Performance budgets
      'categories:performance': ['error', {minScore: 0.9}]
      'categories:accessibility': ['error', {minScore: 0.95}]
      'categories:best-practices': ['error', {minScore: 0.9}]
      'categories:seo': ['warn', {minScore: 0.8}]

      # Core Web Vitals
      'first-contentful-paint': ['warn', {maxNumericValue: 1800}]
      'largest-contentful-paint': ['error', {maxNumericValue: 2500}]
      'cumulative-layout-shift': ['error', {maxNumericValue: 0.1}]
      'total-blocking-time': ['warn', {maxNumericValue: 300}]
      'speed-index': ['warn', {maxNumericValue: 3000}]
      'interactive': ['warn', {maxNumericValue: 3800}]

      # Resource budgets
      'resource-summary:script:size': ['error', {maxNumericValue: 500000}]
      'resource-summary:stylesheet:size': ['warn', {maxNumericValue: 100000}]
      'resource-summary:image:size': ['warn', {maxNumericValue: 300000}]
      'resource-summary:font:size': ['warn', {maxNumericValue: 150000}]
      'resource-summary:total:size': ['error', {maxNumericValue: 2000000}]

      # Network requests
      'resource-summary:total:count': ['warn', {maxNumericValue: 50}]
      'network-requests': ['warn', {maxNumericValue: 50}]

      # JavaScript metrics
      'bootup-time': ['warn', {maxNumericValue: 3000}]
      'mainthread-work-breakdown': ['warn', {maxNumericValue: 4000}]
      'total-byte-weight': ['error', {maxNumericValue: 2000000}]

      # Accessibility
      'color-contrast': 'error'
      'image-alt': 'error'
      'label': 'error'
      'valid-lang': 'error'

  upload:
    target: 'temporary-public-storage'
    # For production, use:
    # target: 'lhci'
    # serverBaseUrl: 'https://your-lhci-server.com'
    # token: $LHCI_TOKEN

  server:
    # Optional: Configure LHCI server for historical data
    # storage:
    #   storageMethod: 'sql'
    #   sqlDatabasePath: './lhci-data.sql'
